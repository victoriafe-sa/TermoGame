<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Termo - O Jogo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .tile {
            width: 60px;
            height: 60px;
            perspective: 1000px;
        }
        .tile-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .tile.flip .tile-inner {
            transform: rotateX(180deg);
        }
        .tile-front, .tile-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            font-weight: bold;
            text-transform: uppercase;
            border-radius: 0.25rem;
        }
        .tile-front {
             border: 2px solid #d1d5db; /* gray-300 */
        }
        .tile-back {
            transform: rotateX(180deg);
            color: white;
        }
        .tile-back.correct {
            background-color: #4ade80; /* green-400 */
            border-color: #4ade80;
        }
        .tile-back.present {
            background-color: #facc15; /* yellow-400 */
            border-color: #facc15;
        }
        .tile-back.absent {
            background-color: #9ca3af; /* gray-400 */
            border-color: #9ca3af;
        }
        .key {
            height: 48px; /* h-12 */
            transition: background-color 0.2s;
        }
        #game-container header {
            padding-bottom: 0.5rem; /* pb-2 */
            margin-bottom: 1rem; /* mb-4 */
        }
        #game-container footer {
            margin-top: 1rem; /* mt-4 */
        }
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 400px;
        }

        /* Media Query para telas com altura menor */
        @media (max-height: 750px) {
            #game-container {
                padding-top: 0.5rem;
                padding-bottom: 0.5rem;
            }
            #game-container > header {
                margin-bottom: 0.5rem; /* Reduz a margem */
            }
            #game-container > footer {
                margin-top: 0.5rem; /* Reduz a margem */
            }
            .tile {
                width: 50px;
                height: 50px;
            }
            .tile-front, .tile-back {
                font-size: 1.75rem;
            }
            .key {
                height: 40px; /* h-10 */
            }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="max-w-6xl w-full mx-auto flex flex-col lg:flex-row gap-8 px-4 py-2 lg:py-8 items-start justify-center">
        <!-- Container Principal do Jogo -->
        <div id="game-container" class="w-full max-w-lg mx-auto lg:mx-0 flex flex-col">
            <!-- Cabe√ßalho -->
            <header class="flex justify-between items-center border-b-2 border-gray-300">
                <h1 class="text-3xl font-bold tracking-wider">TERMO</h1>
                <div id="user-section" class="text-right">
                    <button id="login-register-btn" class="bg-blue-500 text-white px-3 py-1 rounded-md hover:bg-blue-600">Login</button>
                    <div id="user-info" class="hidden">
                        <span id="username-display" class="font-semibold"></span> | <span id="score-display"></span>
                        <button id="logout-btn" class="ml-2 text-sm text-red-500 hover:underline">Sair</button>
                    </div>
                </div>
            </header>

            <!-- Grade do Jogo -->
            <main id="game-board" class="grid grid-rows-6 gap-1.5 my-auto">
                <!-- As linhas e colunas ser√£o geradas via JS -->
            </main>

            <!-- Teclado Virtual -->
            <footer id="keyboard" class="flex flex-col gap-1.5">
                <!-- As teclas ser√£o geradas via JS -->
            </footer>
        </div>

        <!-- Ranking Column -->
        <div id="ranking-container" class="w-full lg:w-80 mt-8 lg:mt-2">
            <h2 class="text-2xl font-bold mb-4 text-center border-b pb-2">üèÜ Ranking - Top 5</h2>
            <ul id="ranking-list" class="space-y-2 bg-white p-4 rounded-lg shadow-md">
                <!-- O ranking ser√° preenchido aqui -->
            </ul>
        </div>
    </div>


    <!-- Modal de Login/Cadastro -->
    <div id="auth-modal" class="modal-backdrop hidden">
        <div class="modal-content text-center">
            <h2 id="auth-title" class="text-2xl font-bold mb-4">Login</h2>
            <input type="text" id="username-input" placeholder="Nome de usu√°rio" class="w-full p-2 border rounded mb-2">
            <input type="password" id="password-input" placeholder="Senha" class="w-full p-2 border rounded mb-4">
            <p id="auth-error" class="text-red-500 text-sm mb-4 h-5"></p>
            <div class="flex gap-2">
                <button id="submit-auth-btn" class="w-full bg-green-500 text-white p-2 rounded hover:bg-green-600">Entrar</button>
                <button id="switch-auth-btn" class="w-full bg-gray-200 p-2 rounded hover:bg-gray-300">Criar conta</button>
            </div>
             <button id="close-auth-modal" class="mt-4 text-gray-500 hover:text-gray-700">Fechar</button>
        </div>
    </div>
    
    <!-- Modal de Fim de Jogo -->
    <div id="end-game-modal" class="modal-backdrop hidden">
        <div class="modal-content text-center">
            <h2 id="end-game-title" class="text-2xl font-bold mb-2"></h2>
            <p id="end-game-message" class="text-lg mb-3"></p>
            <p class="mb-4">A palavra era: <strong id="secret-word-display" class="text-xl"></strong></p>
            <button id="play-again-btn" class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">Jogar Novamente</button>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Elementos da DOM
        const gameBoard = document.getElementById('game-board');
        const keyboardContainer = document.getElementById('keyboard');
        const loginRegisterBtn = document.getElementById('login-register-btn');
        const authModal = document.getElementById('auth-modal');
        const endGameModal = document.getElementById('end-game-modal');
        const rankingList = document.getElementById('ranking-list');

        // Estado do Jogo
        const WORD_LENGTH = 5;
        const MAX_TRIES = 6;
        let currentRow = 0;
        let currentCol = 0;
        let secretWord = '';
        let isGameOver = false;
        
        // Estado do Usu√°rio
        let currentUser = null;
        let users = [];

        const wordList = [
            "sagaz", "amago", "negro", "exito", "termo", "nobre", "afeto", "plena", "etica", "mutua", 
            "tenue", "sutil", "vigor", "aquem", "porem", "fazer", "poder", "sanar", "ouvir", "assim", 
            "secao", "fosse", "ideia", "cerne", "icone", "moral", "desde", "justo", "muito", "honra", 
            "sobre", "anexo", "etnia", "sonho", "tange", "lapso", "haver", "expor", "dengo", "casal", 
            "entao", "posse", "saber", "avido", "devir", "ardil", "genro", "corja", "pesar", "causa", 
            "dizer", "coser", "brado", "prole", "tenaz", "detem", "crivo", "digno", "sendo", "temor", 
            "dever", "graca", "apice", "animo", "comum", "culto", "ceder", "assaz", "atroz", "estar", 
            "pudor", "sonso", "valor", "plato", "orgia", "feliz", "gleba", "fluxo", "cozer", "lugar", 
            "saude", "crise", "praxe", "vital", "ajuda", "mesmo", "dogma", "senil", "ontem", "enfim", 
            "todos", "sorte", "jeito", "impar", "presa", "facil", "round", "ritmo", "futil", "pobre", 
            "ambos", "remir", "morte", "marco", "jovem", "nuvem", "bruma", "capaz", "levar", "reves", 
            "ocaso", "pegar", "carro", "festa", "livro", "chuva", "prado", "forca", "mocas"
        ];

        // INICIALIZA√á√ÉO
        function init() {
            loadUsers();
            checkSession();
            createBoard();
            createKeyboard();
            updateRankingDisplay();
            startNewGame();
            
            if (!currentUser) {
                authModal.classList.remove('hidden');
            }
        }

        function startNewGame() {
            secretWord = wordList[Math.floor(Math.random() * wordList.length)].toUpperCase();
            console.log("Palavra secreta:", secretWord); // Para depura√ß√£o
            currentRow = 0;
            currentCol = 0;
            isGameOver = false;
            gameBoard.innerHTML = '';
            createBoard();
            resetKeyboard();
            endGameModal.classList.add('hidden');
        }
        
        // L√ìGICA DO JOGO
        function createBoard() {
            for (let i = 0; i < MAX_TRIES; i++) {
                const row = document.createElement('div');
                row.className = 'grid grid-cols-5 gap-1.5';
                for (let j = 0; j < WORD_LENGTH; j++) {
                    const tile = document.createElement('div');
                    tile.className = 'tile';
                    const tileInner = document.createElement('div');
                    tileInner.className = 'tile-inner';
                    const tileFront = document.createElement('div');
                    tileFront.className = 'tile-front';
                    const tileBack = document.createElement('div');
                    tileBack.className = 'tile-back';
                    tileInner.appendChild(tileFront);
                    tileInner.appendChild(tileBack);
                    tile.appendChild(tileInner);
                    row.appendChild(tile);
                }
                gameBoard.appendChild(row);
            }
        }

        function createKeyboard() {
            const keys = [
                ['Q', 'W', 'E', 'R', 'T', 'Y', 'U', 'I', 'O', 'P'],
                ['A', 'S', 'D', 'F', 'G', 'H', 'J', 'K', 'L'],
                ['ENTER', 'Z', 'X', 'C', 'V', 'B', 'N', 'M', '√á', 'BACKSPACE']
            ];

            keys.forEach(rowKeys => {
                const row = document.createElement('div');
                row.className = 'flex justify-center gap-1.5';
                rowKeys.forEach(key => {
                    const button = document.createElement('button');
                    button.textContent = key;
                    button.id = `key-${key}`;
                    button.className = 'key rounded-md font-semibold uppercase flex-1 bg-gray-300 hover:bg-gray-400';
                    if (key === 'ENTER' || key === 'BACKSPACE') {
                        button.classList.add('px-2', 'text-xs');
                        button.style.flex = '1.5';
                    }
                    button.addEventListener('click', () => handleKeyPress(key));
                    row.appendChild(button);
                });
                keyboardContainer.appendChild(row);
            });
        }
        
        function handleKeyPress(key) {
            if (isGameOver) return;

            if (key === 'ENTER') {
                submitGuess();
            } else if (key === 'BACKSPACE') {
                deleteLetter();
            } else if (key.match(/^[A-Z√á]$/)) {
                addLetter(key);
            }
        }

        function addLetter(letter) {
            if (currentCol < WORD_LENGTH) {
                const tile = gameBoard.children[currentRow].children[currentCol];
                tile.querySelector('.tile-front').textContent = letter;
                tile.querySelector('.tile-back').textContent = letter;
                currentCol++;
            }
        }
        
        function deleteLetter() {
            if (currentCol > 0) {
                currentCol--;
                const tile = gameBoard.children[currentRow].children[currentCol];
                tile.querySelector('.tile-front').textContent = '';
                tile.querySelector('.tile-back').textContent = '';
            }
        }

        function submitGuess() {
            if (currentCol !== WORD_LENGTH) {
                return;
            }

            const guess = Array.from(gameBoard.children[currentRow].children)
                               .map(tile => tile.querySelector('.tile-front').textContent)
                               .join('');
            
            flipTiles(guess);
        }

        function flipTiles(guess) {
            const tiles = gameBoard.children[currentRow].children;
            const secretWordLetters = secretWord.split('');
            const guessLetters = guess.split('');
            const keyColors = {};

            // Marcar corretos (verde)
            for (let i = 0; i < WORD_LENGTH; i++) {
                const tileBack = tiles[i].querySelector('.tile-back');
                if (guessLetters[i] === secretWordLetters[i]) {
                    tileBack.classList.add('correct');
                    secretWordLetters[i] = null; // Para evitar contagem dupla
                    keyColors[guessLetters[i]] = 'correct';
                }
            }

            // Marcar presentes (amarelo) e ausentes (cinza)
            for (let i = 0; i < WORD_LENGTH; i++) {
                const tileBack = tiles[i].querySelector('.tile-back');
                if (!tileBack.classList.contains('correct')) {
                    const letterIndex = secretWordLetters.indexOf(guessLetters[i]);
                    if (letterIndex > -1) {
                        tileBack.classList.add('present');
                        secretWordLetters[letterIndex] = null;
                        if (keyColors[guessLetters[i]] !== 'correct') {
                            keyColors[guessLetters[i]] = 'present';
                        }
                    } else {
                        tileBack.classList.add('absent');
                        if (!keyColors[guessLetters[i]]) {
                            keyColors[guessLetters[i]] = 'absent';
                        }
                    }
                }
            }

            // Anima√ß√£o de virar
            let delay = 0;
            for (let tile of tiles) {
                setTimeout(() => tile.classList.add('flip'), delay);
                delay += 100;
            }

            setTimeout(() => {
                updateKeyboard(keyColors);
                if (guess === secretWord) {
                    endGame(true);
                } else if (currentRow === MAX_TRIES - 1) {
                    endGame(false);
                } else {
                    currentRow++;
                    currentCol = 0;
                }
            }, delay + 500);
        }
        
        function updateKeyboard(keyColors) {
            for (const [key, color] of Object.entries(keyColors)) {
                const keyElement = document.getElementById(`key-${key}`);
                if (!keyElement) continue;
                keyElement.classList.remove('bg-green-400', 'bg-yellow-400', 'bg-gray-500', 'bg-gray-300');
                if (color === 'correct') keyElement.classList.add('bg-green-400', 'text-white');
                else if (color === 'present') keyElement.classList.add('bg-yellow-400', 'text-white');
                else if (color === 'absent') keyElement.classList.add('bg-gray-500', 'text-white');
            }
        }
        
        function resetKeyboard() {
            document.querySelectorAll('.key').forEach(key => {
                key.className = 'key rounded-md font-semibold uppercase flex-1 bg-gray-300 hover:bg-gray-400';
                 if (key.textContent === 'ENTER' || key.textContent === 'BACKSPACE') {
                    key.classList.add('px-2', 'text-xs');
                    key.style.flex = '1.5';
                }
            });
        }
        
        function endGame(isWin) {
            isGameOver = true;
            document.getElementById('secret-word-display').textContent = secretWord;
            const endGameTitle = document.getElementById('end-game-title');
            const endGameMessage = document.getElementById('end-game-message');

            if (isWin) {
                const pointsWon = MAX_TRIES - currentRow;
                endGameTitle.textContent = "Parab√©ns, voc√™ venceu!";
                endGameMessage.textContent = `Voc√™ ganhou ${pointsWon} pontos!`;
                if (currentUser) {
                    currentUser.score += pointsWon;
                    updateUser(currentUser);
                    updateScoreDisplay();
                }
            } else {
                 endGameTitle.textContent = "Fim de jogo!";
                 endGameMessage.textContent = "Mais sorte da pr√≥xima vez.";
            }
            setTimeout(() => endGameModal.classList.remove('hidden'), 500);
        }

        // SISTEMA DE USU√ÅRIOS E RANKING
        function updateRankingDisplay() {
            const sortedUsers = [...users].sort((a, b) => b.score - a.score).slice(0, 5);
            rankingList.innerHTML = '';
            if (sortedUsers.length === 0) {
                rankingList.innerHTML = '<li class="text-gray-500 text-center">Nenhum jogador ranqueado.</li>';
            } else {
                sortedUsers.forEach((user, index) => {
                    const li = document.createElement('li');
                    li.className = 'flex justify-between items-center p-2 rounded ' + (index % 2 === 0 ? 'bg-gray-50' : '');
                    li.innerHTML = `
                        <div class="flex items-center">
                            <span class="font-semibold text-gray-500 w-6">${index + 1}.</span>
                            <span class="font-semibold">${user.username}</span>
                        </div>
                        <span class="text-blue-600 font-bold">${user.score} pts</span>
                    `;
                    rankingList.appendChild(li);
                });
            }
        }

        function loadUsers() {
            const usersData = localStorage.getItem('termoUsers');
            if (usersData) {
                users = JSON.parse(usersData);
            }
        }

        function saveUsers() {
            localStorage.setItem('termoUsers', JSON.stringify(users));
        }
        
        function checkSession() {
            const sessionUser = sessionStorage.getItem('termoCurrentUser');
            if (sessionUser) {
                currentUser = JSON.parse(sessionUser);
                showUserInfo();
            }
        }

        function showUserInfo() {
            document.getElementById('user-info').classList.remove('hidden');
            document.getElementById('login-register-btn').classList.add('hidden');
            document.getElementById('username-display').textContent = currentUser.username;
            updateScoreDisplay();
        }

        function hideUserInfo() {
            document.getElementById('user-info').classList.add('hidden');
            document.getElementById('login-register-btn').classList.remove('hidden');
        }
        
        function updateScoreDisplay() {
             document.getElementById('score-display').textContent = `Pts: ${currentUser.score}`;
        }
        
        function updateUser(updatedUser) {
            const index = users.findIndex(u => u.username === updatedUser.username);
            if (index > -1) {
                users[index] = updatedUser;
                saveUsers();
                sessionStorage.setItem('termoCurrentUser', JSON.stringify(updatedUser));
                updateRankingDisplay();
            }
        }

        function handleAuthSubmit(isRegister) {
            const username = document.getElementById('username-input').value.trim();
            const password = document.getElementById('password-input').value;
            const errorP = document.getElementById('auth-error');
            errorP.textContent = '';

            if (!username || !password) {
                errorP.textContent = 'Preencha todos os campos.';
                return;
            }

            if (isRegister) {
                if (users.find(u => u.username.toLowerCase() === username.toLowerCase())) {
                    errorP.textContent = 'Este nome de usu√°rio j√° existe.';
                } else {
                    const newUser = { username, password, score: 0 };
                    users.push(newUser);
                    saveUsers();
                    updateRankingDisplay();
                    alert('Cadastro realizado com sucesso! Fa√ßa o login.');
                    document.getElementById('switch-auth-btn').click(); // Volta para tela de login
                }
            } else { // Login
                const user = users.find(u => u.username.toLowerCase() === username.toLowerCase() && u.password === password);
                if (user) {
                    currentUser = user;
                    sessionStorage.setItem('termoCurrentUser', JSON.stringify(user));
                    showUserInfo();
                    authModal.classList.add('hidden');
                } else {
                    errorP.textContent = 'Usu√°rio ou senha inv√°lidos.';
                }
            }
        }
        
        // MANIPULADORES DE EVENTOS
        document.addEventListener('keydown', (e) => {
            if (authModal.classList.contains('hidden') && endGameModal.classList.contains('hidden')) {
                const key = e.key.toUpperCase();
                if (key === 'ENTER' || key === 'BACKSPACE' || (key.length === 1 && (key >= 'A' && key <= 'Z' || key === '√á'))) {
                    handleKeyPress(key);
                }
            }
        });

        loginRegisterBtn.addEventListener('click', () => {
            document.getElementById('username-input').value = '';
            document.getElementById('password-input').value = '';
            document.getElementById('auth-error').textContent = '';
            authModal.classList.remove('hidden');
        });

        document.getElementById('logout-btn').addEventListener('click', () => {
            currentUser = null;
            sessionStorage.removeItem('termoCurrentUser');
            hideUserInfo();
            authModal.classList.remove('hidden');
        });

        let isRegisterMode = false;
        document.getElementById('switch-auth-btn').addEventListener('click', (e) => {
            isRegisterMode = !isRegisterMode;
            document.getElementById('auth-title').textContent = isRegisterMode ? 'Cadastro' : 'Login';
            document.getElementById('submit-auth-btn').textContent = isRegisterMode ? 'Cadastrar' : 'Entrar';
            e.target.textContent = isRegisterMode ? 'J√° tenho conta' : 'Criar conta';
            document.getElementById('auth-error').textContent = '';
        });

        document.getElementById('submit-auth-btn').addEventListener('click', () => handleAuthSubmit(isRegisterMode));
        
        document.getElementById('close-auth-modal').addEventListener('click', () => {
            authModal.classList.add('hidden');
        });
        
        document.getElementById('play-again-btn').addEventListener('click', startNewGame);

        // Iniciar o jogo
        init();
    });
</script>
</body>
</html>

